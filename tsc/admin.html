<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Админка — Технологические карты</title>
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
  <div class="topbar">
    <div class="container">
      <div class="backRow">
        <button class="backBtn" id="backToSite" type="button">
          <img src="/tsc/assets/icons/back.svg" alt="back" />
          <span>Назад</span>
        </button>
        <button class="squareBtn danger hasTip" id="resetBtn" type="button" data-tip="Сбросить кеш" aria-label="Сбросить кеш">
          <img src="/tsc/assets/icons/clear.svg" alt="clear" />
        </button>
      </div>

      <div class="headerRow" style="padding-top:0;">
        <h1 class="siteTitle">СЫТНАЯ ДОСТАВКА<br/>Технологические карты</h1>
      </div>

      <div class="controls">
        <div class="dropdown" id="deliveryDrop">
          <button class="dropBtn" type="button">
            <span class="label">Доставка:</span>
            <span class="value" id="deliveryValue">Все</span>
            <span class="chev">▼</span>
          </button>
          <div class="menu"></div>
        </div>

        <div class="dropdown" id="categoryDrop">
          <button class="dropBtn" type="button">
            <span class="label">Категория:</span>
            <span class="value" id="categoryValue">Все</span>
            <span class="chev">▼</span>
          </button>
          <div class="menu"></div>
        </div>

        <div class="dropdown" id="sortDrop">
          <button class="dropBtn" type="button">
            <span class="label">Сортировка:</span>
            <span class="value" id="sortValue">Название A→Z</span>
            <span class="chev">▼</span>
          </button>
          <div class="menu"></div>
        </div>
      </div>

      <div class="searchRow">
        <input id="searchInput" class="searchInput" type="search" placeholder="Поиск по названию..." />
        <button id="clearSearch" class="searchClear" type="button" title="Очистить">✕</button>
      </div>
    </div>
  </div>

  <main class="container">
    <div class="adminTop">
      <h2 class="adminTitle">Панель администратора</h2>

      <div class="adminActions">
        <button class="smallBtn primary" id="addBtn" type="button">
          <img src="/tsc/assets/icons/plus.svg" alt="+" />
          Добавить блюдо
        </button>

        <!-- Excel -->
        <button class="smallBtn hasTip" id="bulkExcelBtn" type="button" data-tip="Шаблон Excel" aria-label="Шаблон Excel">
          <img src="/tsc/assets/icons/excel.svg" alt="" />
        </button>

        <button class="squareBtn hasTip" id="saveGithubBtn" type="button" data-tip="Сохранить в GitHub" aria-label="Сохранить в GitHub">
          <img src="/tsc/assets/icons/save.svg" alt="save" />
        </button>

        <button class="squareBtn danger is-hidden hasTip" id="deleteSelectedBtn" disabled type="button" data-tip="Удалить выбранные" aria-label="Удалить выбранные">
          <img src="/tsc/assets/icons/delete.svg" alt="delete" />
          <span class="badgeCount" aria-hidden="true">0</span>
        </button>

        <button class="squareBtn hasTip" id="logoutBtn" type="button" data-tip="Выйти" aria-label="Выйти">
          <img src="/tsc/assets/icons/logout.svg" alt="logout" />
        </button>
      </div>
    </div>

    <div class="adminList" id="list"></div>
    <div class="empty" id="empty" style="display:none;">Список пуст.</div>
  </main>

  <!-- EDIT MODAL -->
  <div class="modalWrap" id="modalWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHead">
        <h3 id="modalTitle">Добавить блюдо</h3>
        <button class="iconBtn" id="closeModal" type="button" title="Закрыть">✕</button>
      </div>
      <div class="modalBody">
        <form id="form">
          <div class="formGrid">
            <div class="field">
              <label>ID (уникальный)</label>
              <input id="f_id" placeholder="например: sushi-007" required />
            </div>

            <div class="field">
              <label>Доставка</label>
              <select id="f_delivery" required></select>
            </div>

            <div class="field">
              <label>Категория</label>
              <input id="f_category" placeholder="например: Роллы" required />
            </div>

            <div class="field">
              <label>Название блюда</label>
              <input id="f_name" placeholder="например: Филадельфия" required />
            </div>

            <div class="field" style="grid-column:1/-1;">
              <label>Описание / технологическая карта</label>
              <textarea id="f_desc" placeholder="Текст..." required></textarea>
            </div>

            <div class="field" style="grid-column:1/-1;">
              <label>Фото</label>
              <input type="file" id="f_photo" accept="image/*" />
              <small style="opacity:.6;">
                Если фото не выбрано — будет использована заглушка.
              </small>
            </div>
          </div>
        </form>
      </div>
      <div class="modalFoot">
        <button class="smallBtn" id="cancelBtn" type="button">Отмена</button>
        <button class="smallBtn primary" id="saveBtn" type="button">Сохранить</button>
      </div>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div class="modalWrap" id="loginWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHead">
        <h3>Вход в панель администратора</h3>
      </div>

      <div class="modalBody">
        <div class="formGrid">
          <div class="field" style="grid-column:1/-1;">
            <label>Пароль</label>
            <input id="loginPass" type="password" placeholder="Введите пароль…" />
          </div>
          <div id="loginError" style="grid-column:1/-1;opacity:.85;display:none;color:#ff7b7b;">
            Неверный пароль
          </div>
        </div>
      </div>

      <div class="modalFoot">
        <button class="smallBtn" id="loginCancel" type="button">Назад</button>
        <button class="smallBtn primary" id="loginOk" type="button">Войти</button>
      </div>
    </div>
  </div>

  <!-- GITHUB TOKEN MODAL -->
  <div class="modalWrap" id="tokenWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHead">
        <h3>Ключ сохранения</h3>
        <button class="iconBtn" id="tokenClose" type="button" title="Закрыть">✕</button>
      </div>

      <div class="modalBody">
        <div class="formGrid" style="grid-template-columns: 1fr;">
          <div class="field" style="grid-column:1/-1;">
            <input id="tokenInput" type="password" placeholder="вставьте ключ сохранения..." autocomplete="off" />
            <small class="hintText">
              Ключ нужен для сохранения изменений на сервер.
            </small>
          </div>

          <div class="tokenRow" style="grid-column:1/-1;">
            <label class="checkLine">
              <input id="tokenRemember" type="checkbox" />
              <span>Запомнить ключ на этом устройстве</span>
            </label>
          </div>

          <div id="tokenStatus" class="tokenStatus" style="grid-column:1/-1;"></div>
        </div>
      </div>

      <div class="modalFoot">
        <button class="smallBtn" id="tokenCancel" type="button">Отмена</button>
        <button class="smallBtn" id="tokenCheckBtn" type="button">Проверить</button>
        <button class="smallBtn primary" id="tokenSaveBtn" type="button">Сохранить</button>
      </div>
    </div>
  </div>

  <button class="toTopBtn" id="toTopBtn" type="button" title="Наверх">
    <svg viewBox="0 0 24 24" width="18" height="18" fill="none">
      <path d="M12 5l-6 6M12 5l6 6" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M12 5v14" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- EXCEL MODAL (как остальные модалки) -->
  <div class="modalWrap" id="excelWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHead">
        <h3>Импорт блюд из Excel</h3>
        <button class="iconBtn" id="excelCloseBtn" type="button" title="Закрыть">✕</button>
      </div>

      <div class="modalBody">
        <div class="formGrid" style="grid-template-columns: 1fr;">
          <div class="field" style="grid-column:1/-1;">
            <a class="smallBtn" href="assets/templates/dishes_template.xlsx" download>
  <img src="/tsc/assets/icons/download.svg" alt="" />
  Скачать шаблон
</a>
            <small class="hintText">Колонки: delivery, category, name, description (id — необязательно)</small>
          </div>

          <div class="field" style="grid-column:1/-1;">
            <input type="file" id="excelFileInput" accept=".xlsx" />
          </div>

          <div id="excelStats" style="grid-column:1/-1; opacity:.85;"></div>
        </div>
      </div>

      <div class="modalFoot">
        <button class="smallBtn" id="excelImportBtn" type="button">Импортировать</button>
        <button class="smallBtn" id="excelCancelBtn" type="button">Отмена</button>
      </div>
    </div>
  </div>

  <!-- SheetJS для чтения Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <script type="module" src="/tsc/js/admin.js"></script>
</body>
</html>
