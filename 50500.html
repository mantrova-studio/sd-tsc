<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Кнопки</title>

<style>
  body{
    margin:0;
    background:#000;
    font-family: system-ui, -apple-system, sans-serif;
    min-height:100vh;
    display:flex;
    justify-content:center;
    padding:30px 10px 90px;
    color:#fff;
  }

  .wrap{ width:100%; max-width:900px; }

  .grid{
    width:100%;
    display:grid;
    grid-template-columns: repeat(10, 1fr);
    gap:12px;
  }

  .btn{
    user-select:none;
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:10px;
    padding:10px 0;
    color:#fff;
    font-weight:600;
    text-align:center;
    cursor:pointer;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);

    /* базовое состояние */
    opacity:1;
    transform: translateY(0) scale(1);
    filter: blur(0px);
    transition: background .15s ease;
    will-change: opacity, transform, filter;
  }

  .btn:hover{ background:rgba(255,255,255,0.15); }
  .btn:active{ transform: translateY(0) scale(0.97); }

  /* Стадии анимации (делаем через классы, чтобы было "растворение") */
  .btn.vanish{
    animation: dissolveOut .42s ease forwards;
  }
  .btn.appear{
    animation: dissolveIn .32s ease forwards;
  }

  @keyframes dissolveOut{
    0%{
      opacity:1;
      transform: translateY(0) scale(1);
      filter: blur(0px);
    }
    60%{
      opacity:0.45;
      transform: translateY(6px) scale(0.99);
      filter: blur(2px);
    }
    100%{
      opacity:0;
      transform: translateY(12px) scale(0.985);
      filter: blur(6px);
    }
  }

  @keyframes dissolveIn{
    0%{
      opacity:0;
      transform: translateY(12px) scale(0.985);
      filter: blur(6px);
    }
    70%{
      opacity:0.75;
      transform: translateY(4px) scale(0.995);
      filter: blur(2px);
    }
    100%{
      opacity:1;
      transform: translateY(0) scale(1);
      filter: blur(0px);
    }
  }

  /* итоговое скрытое состояние (после растворения) */
  .btn.hidden{
    opacity:0;
  }

  .sumBar{
    position:fixed;
    left:0; right:0;
    bottom:18px;
    display:flex;
    justify-content:center;
    pointer-events:none;
  }

  .sumPill{
    padding:10px 16px;
    border-radius:999px;
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.22);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow:0 10px 24px rgba(0,0,0,0.45);
    font-weight:700;
    letter-spacing:.2px;
  }

  @media(max-width:700px){
    .grid{ grid-template-columns: repeat(5, 1fr); }
  }
  @media(max-width:420px){
    .grid{ grid-template-columns: repeat(3, 1fr); }
  }
</style>
</head>

<body>
  <div class="wrap">
    <div class="grid" id="grid"></div>
  </div>

  <div class="sumBar">
    <div class="sumPill" id="sumPill">Накоплено: 0</div>
  </div>

<script>
  const grid = document.getElementById("grid");
  const sumPill = document.getElementById("sumPill");

  const STORAGE_KEY = "hidden_buttons_v1";
  const hidden = new Set(loadHidden());

  function loadHidden(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr.map(Number) : [];
    }catch{
      return [];
    }
  }

  function saveHidden(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify([...hidden]));
  }

  function updateSum(){
    let sum = 0;
    hidden.forEach(v => sum += v);
    sumPill.textContent = "Сумма: " + sum;
  }

  function restartAnim(el, cls){
    el.classList.remove("vanish","appear");
    void el.offsetWidth;
    el.classList.add(cls);
  }

  function makeBtn(value){
    const btn = document.createElement("div");
    btn.className = "btn";
    btn.textContent = value;

    if(hidden.has(value)){
      btn.classList.add("hidden");
    }

    btn.addEventListener("click", ()=>{
      if(hidden.has(value)){
        // показать
        hidden.delete(value);
        btn.classList.remove("hidden");
        restartAnim(btn, "appear");
      }else{
        // скрыть с растворением
        hidden.add(value);
        restartAnim(btn, "vanish");

        // после анимации фиксируем hidden
        const onEnd = ()=>{
          btn.classList.add("hidden");
          btn.classList.remove("vanish");
          btn.removeEventListener("animationend", onEnd);
        };
        btn.addEventListener("animationend", onEnd);
      }

      saveHidden();
      updateSum();
    });

    return btn;
  }

  for(let i = 10; i <= 1000; i += 10){
    grid.appendChild(makeBtn(i));
  }

  updateSum();
</script>

</body>
</html>
